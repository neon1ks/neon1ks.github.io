<!DOCTYPE HTML>
<html lang="ru">
<head>
<title>Аргументы функции main(): argv и argc - cправочник по Си</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../work/css.css">
</head>
<body>


<a href="../main.htm#06">Содержание</a> | <a href="0603.htm">&lt;&lt;&lt;</a> | <a href="0605.htm">&gt;&gt;&gt;</a><hr>
<h1>Аргументы функции main(): argv и argc</h1>
<p class="tj">Иногда при запуске программы бывает полезно передать ей какую-либо информацию. Обычно такая информация передается функции <kbd>main()</kbd> с помощью аргументов командной строки. <em>Аргумент командной строки</em> — это информация, которая вводится в командной строке операционной системы вслед за именем программы. Например, чтобы запустить компиляцию программы, необходимо в командной строке после подсказки набрать примерно следующее:
<pre>cc <em>имя_программы</em></pre>
<p class="t"><em>имя_программы</em> представляет собой аргумент командной строки, он указывает имя той программы, которую вы собираетесь компилировать.
<p class="tj">Чтобы принять аргументы командной строки, используются два специальных встроенных аргумента: <kbd>argc</kbd> и <kbd>argv</kbd>. Параметр <kbd>argc</kbd> содержит количество аргументов в командной строке и является целым числом, причем он всегда не меньше 1, потому что первым аргументом считается имя программы. А параметр <kbd>argv</kbd> является указателем на массив указателей на строки. В этом массиве каждый элемент указывает на какой-либо аргумент командной строки. Все аргументы командной строки являются строковыми, поэтому преобразование каких бы то ни было чисел в нужный двоичный формат должно быть предусмотрено в программе при ее разработке.
<p class="tj">Вот простой пример использования аргумента командной строки. На экран выводятся слово <kbd>Привет</kbd> и ваше имя, которое надо указать в виде аргумента командной строки.
<pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
int main(int argc, char *argv[])
{
  if(argc!=2) {
    printf("Вы забыли ввести свое имя.\n");
    exit(1);
  }
  printf("Привет %s", argv[1]);
  return 0;
}
</pre>
<p class="tj">Если вы назвали эту программу <kbd>name</kbd> (имя) и ваше имя Том, то для запуска программы следует в командную строку ввести <kbd>name Том</kbd>. В результате выполнения программы на экране появится сообщение <kbd>Привет, Том</kbd>.
<p class="tj">Во многих средах все аргументы командной строки необходимо отделять друг от друга пробелом или табуляцией. Запятые, точки с запятой и тому подобные символы разделителями не считаются. Например,
<pre>run Spot, run</pre>
<p class="t">состоит из трех символьных строк, в то время как
<pre>Эрик, Рик, Фред</pre>
<p class="t">представляет собой одну символьную строку — запятые, как правило, разделителями не считаются.
<p class="tj">Если в строке имеются пробелы, то, чтобы из нее не получилось несколько аргументов, в некоторых средах эту строку можно заключать в двойные кавычки. В результате вся строка будет считаться одним аргументом. Чтобы подробнее узнать, как в вашей операционной системе задаются параметры командной строки, изучите документацию этой системы.
<p class="tj">Очень важно правильно объявлять <kbd>argv</kbd>. Вот как это делают чаще всего:
<pre>char *argv[];</pre>
<p class="tj">Пустые квадратные скобки указывают на то, что у массива неопределенная длина. Теперь получить доступ к отдельным аргументам можно с помощью индексации массива <kbd>argv</kbd>. Например, <kbd>argv[0]</kbd> указывает на первую символьную строку, которой всегда является имя программы; <kbd>argv[1]</kbd> указывает на первый аргумент и так далее.
<p class="tj">Другим небольшим примером использования аргументов командной строки является приведенная далее программа <kbd>countdown</kbd> (счет в обратном порядке). Эта программа считает в обратном порядке, начиная с какого-либо значения (указанного в командной строке), и подает звуковой сигнал, когда доходит до 0. Обратите внимание, что первый аргумент, содержащий начальное значение, преобразуется в целое значение с помощью стандартной функции <kbd>atoi()</kbd>. Если вторым аргументом командной строки (а если считать аргументом имя программы, то третьим) является строка "display" (вывод на экран), то результат отсчета (в обратном порядке) будет выводиться на экран.
<pre>
/* Программа счета в обратном порядке. */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;ctype.h&gt;
#include &lt;string.h&gt;
int main(int argc, char *argv[])
{
  int disp, count;
  if(argc&lt;2) {
    printf("В командной строке необходимо ввести число,
            с которого\n");
    printf("начинается отсчет.  Попробуйте снова.\n");
    exit(1);
  }
  if(argc==3 && !strcmp(argv[2], "display")) disp = 1;
  else disp = 0;
  for(count=atoi(argv[1]); count; --count)
    if(disp) printf("%d\n", count);
  putchar('\a');  /* здесь подается звуковой сигнал */
  printf("Счет закончен");
  return 0;
}
</pre>
<p class="tj">Обратите внимание, если аргументы командной строки не будут указаны, то будет выведено сообщение об ошибке. В программах с аргументами командной строки часто делается следующее: в случае, когда пользователь запускает эти программы без ввода нужной информации, выводятся инструкции о том, как правильно указывать аргументы.
<p class="tj">Чтобы получить доступ к отдельному символу одного из аргументов командной строки, введите в <kbd>argv</kbd> второй индекс. Например, следующая программа посимвольно выводит все аргументы, с которыми ее вызвали:
<pre>
#include &lt;stdio.h&gt;
int main(int argc, char *argv[])
{
  int t, i;
  for(t=0; t&lt;argc; ++t) {
    i = 0;
    while(argv[t][i]) {
      putchar(argv[t][i]);
      ++i;
    }
    printf("\n");
  }
  return 0;
}
</pre>
<p class="tj">Помните, первый индекс <kbd>argv</kbd> обеспечивает доступ к строке, а второй индекс — доступ к ее отдельным символам.
<p class="tj">Обычно <kbd>argc</kbd> и <kbd>argv</kbd> используют для того, чтобы передать программе начальные команды, которые понадобятся ей при запуске. Например, аргументы командной строки часто указывают такие данные, как имя файла, параметр или альтернативное поведение. Использование аргументов командной строки придает вашей программе "профессиональный внешний вид" и облегчает ее использование в пакетных файлах.
<p class="tj">Имена <kbd>argc</kbd> и <kbd>argv</kbd> являются традиционными, но не обязательными. Эти два параметра в функции <kbd>main()</kbd> вы можете назвать как угодно. Кроме того, в некоторых компиляторах для <kbd>main()</kbd> могут поддерживаться-дополнительные аргументы, поэтому обязательно изучите документацию к вашему компилятору.
<p class="tj">Когда для программы не требуются параметры командной строки, то чаще всего явно декларируют функцию <kbd>main()</kbd> как не имеющую параметров. В таком случае в списке параметров этой функции используют ключевое слово <kbd>void</kbd>.
<p>
</p>
<hr><a href="../main.htm#06">Содержание</a> | <a href="0603.htm">&lt;&lt;&lt;</a> | <a href="0605.htm">&gt;&gt;&gt;</a>


</body>
</html>
